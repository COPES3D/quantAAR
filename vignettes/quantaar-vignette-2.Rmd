---
title: "Spit attribution for small scale excavations"
author: "Clemens Schmid"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Spit attribution for small scale excavations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, message=FALSE}
devtools::load_all()
library(plotly)
library(kriging)
library(ggplot2)
library(reshape2)
library(dplyr)
library(magrittr)
```

Create data

```{r}
edges <- data.frame(
  x = c(0, 3, 0, 3, 0, 3, 0, 3),
  y = c(0, 0, 0, 0, 1, 1, 1, 1),
  z = c(0, 0, 2, 2, 0, 0, 2, 2)
)

df1 <- data.frame(
  x = c(rep(0, 6), seq(0.2, 2.8, 0.2), seq(0.2, 2.8, 0.2), rep(3,6)),
  y = c(seq(0, 1, 0.2), rep(0, 14), rep(1, 14), seq(0, 1, 0.2)), 
  z = c(1+0.1*rnorm(6), 1+0.1*rnorm(14), 0.8+0.1*rnorm(14), 0.8+0.1*rnorm(6))
)

df2 <- data.frame(
  x = c(rep(0, 6), seq(0.2, 2.8, 0.2), seq(0.2, 2.8, 0.2), rep(3,6)),
  y = c(seq(0, 1, 0.2), rep(0, 14), rep(1, 14), seq(0, 1, 0.2)),
  z = c(0.5+0.1*rnorm(6), 0.5+0.1*rnorm(14), 0.4+0.1*rnorm(14), 0.4+0.1*rnorm(6))
)
```

```{r fig.width=7, fig.height=5}
plot_ly(edges, x = x, y = y, z = z, type = "scatter3d", mode = "markers")
```

```{r }
lpoints <- list(df1, df2)
```

```{r }
maps <- kriglist(lpoints, lags = 3, model = "spherical")
```

```{r fig.width=7, fig.height=5}
surf1 <- spatialwide(maps[[1]]$x, maps[[1]]$y, maps[[1]]$pred)
surf2 <- spatialwide(maps[[2]]$x, maps[[2]]$y, maps[[2]]$pred)

x1 <- as.numeric(colnames(surf1))
y1 <- as.numeric(rownames(surf1))
z1 <- as.matrix(surf1)
x2 <- as.numeric(colnames(surf2))
y2 <- as.numeric(rownames(surf2))
z2 <- as.matrix(surf2)


vis <- plot_ly(x = x1, y = x1, z = z1, type = "surface", showscale = FALSE
  ) %>%
  add_trace(data = df1, x = x, y = y, z = z, 
            mode = "markers", type = "scatter3d", 
            marker = list(size = 4, color = "red", symbol = 104)
  ) %>%
  add_trace(x = x2, y = x2, z = z2, type = "surface", showscale = FALSE
  ) %>%
  add_trace(data = df2, x = x, y = y, z = z, 
            mode = "markers", type = "scatter3d", 
            marker = list(size = 4, color = "blue", symbol = 104)
  ) %>% 
  layout(showlegend = FALSE)
  
vis
```

```{r }
hexatestdf <- data.frame(
  x = c(0,1,0,4,5,5,5,5),
  y = c(1,1,4,4,1,1,4,4),
  z = c(4,8,4,9,4,8,4,6)
)

hexatest <- as.matrix(hexatestdf)

# put all cubes in a list
#cubelist <- list(excube)

cx = fillhexa(hexatest, 0.1)
cx <- data.frame(cx)
colnames(cx) <- c("x", "y" , "z")
```